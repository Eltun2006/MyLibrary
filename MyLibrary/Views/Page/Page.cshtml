@model List<Book>

@{
    ViewBag.Title = "My Library";
}

<style>
    body {
        font-family: Arial;
        margin: 0;
        padding: 0;
        background: #fdf6e3;
        color: #333;
    }

    .container {
        display: flex;
        min-height: 100vh;
    }

    .sidebar-container {
        width: 180px;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .sidebar-buttons {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background: rgba(255,255,255,0.2);
        backdrop-filter: blur(2px);
    }

        .sidebar-buttons button {
            padding: 10px;
            border: none;
            background: none;
            border-radius: 5px;
            cursor: pointer;
            transition: .3s;
        }

            .sidebar-buttons button:hover {
                background: rgba(0,0,0,0.1);
            }

    .divider {
        position: absolute;
        top: 0;
        right: 0;
        width: 2px;
        height: 100%;
        background: rgba(0,0,0,0.2);
    }

        .divider:hover {
            background: #333;
        }

    .content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
    }

    .book-list li {
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(255,255,255,0.4);
        border-radius: 10px;
    }

    .book-list img {
        margin-top: 5px;
        border-radius: 5px;
        width: 120px;
    }

    #bookModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

        #bookModal .modal-content {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #bookModal input, #bookModal textarea {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #bookModal button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

            #bookModal button[type="submit"] {
                background: #333;
                color: #fff;
            }

            #bookModal button#closeModal {
                background: #ccc;
            }
</style>

<div class="container">
    <div class="sidebar-container">
        <div class="sidebar-buttons">
            <h3>@ViewBag.UserName</h3>
            <button onclick="location.href='@Url.Action("Libraries", "Library")'">All Libraries</button>
            <button onclick="location.href='@Url.Action("Login", "Account")'">Logout</button>
        </div>
        <div class="divider"></div>
    </div>

    <div class="content">
        <h2>My Books</h2>
        <hr>
        <button id="addBookBtn" type="submit">+ Add Book</button>

        <ul class="book-list">
            @foreach (var book in Model)
            {
                <li>
                    <strong>@book.Title</strong><br>
                    <em>Notes:</em> @book.Notes <br>
                    <em>Thoughts:</em> @book.Thoughts <br>
                    @if (!string.IsNullOrEmpty(book.ImagePath))
                    {
                        <img src="@book.ImagePath" />
                    }

                    <div class="book-item">
                        <form asp-action="RemoveBook" method="post" style="display:inline;">
                            <input type="hidden" name="id" value="@book.Id" />
                            <button type="submit" class="btn btn-danger btn-sm">Sil</button>
                        </form>
                    </div>
                </li>
            }

        </ul>

    </div>
</div>


<div id="bookModal">
    <div class="modal-content">
        <h2>Add New Book</h2>
        <form asp-action="AddBook" asp-controller="Page" method="post" enctype="multipart/form-data">
            <input type="text" name="Title" placeholder="Book Title" required />
            <textarea name="Notes" placeholder="Notes about the book"></textarea>
            <textarea name="Thoughts" placeholder="Your thoughts"></textarea>

            <label for="ImageFile">
                <span class="placeholder">Şəkil<br>Photo/ Фото</span>
                <img id="preview" src="" style="display:none;width:120px;margin-top:5px;" />
            </label>
            <input type="file" name="ImageFile" id="ImageFile" accept="image/*" />

            <button type="submit">Add Book</button>
            <button type="button" id="closeModal">Cancel</button>
        </form>

    </div>
</div>

<script>
       document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('bookModal');
        const btnOpen = document.getElementById('addBookBtn');
        const btnClose = document.getElementById('closeModal');

        btnOpen.addEventListener('click', () => modal.style.display='flex');
        btnClose.addEventListener('click', () => modal.style.display='none');

        const fileInput = document.getElementById('ImageFile');
        const preview = document.getElementById('preview');
        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = e => {
                    preview.src = e.target.result;
                    preview.style.display='block';
                }
                reader.readAsDataURL(file);
            }
        });
    });

</script>