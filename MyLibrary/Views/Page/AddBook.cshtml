@model Book
@{
    ViewBag.Title = "Yeni Kitab Əlavə Et";
}

<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f8efe6 0%, #f1e4cf 100%);
        font-family: 'Georgia', serif;
        color: #3a2e27;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
    }

    .container {
        display: flex;
        width: 100%;
        max-width: 1200px;
        margin: 40px auto;
        background: rgba(255, 255, 240, 0.96);
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .sidebar {
        width: 220px;
        background: linear-gradient(180deg, #d9c8a9 0%, #cdb890 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 25px 15px;
        border-right: 2px solid #bda377;
    }

        .sidebar h3 {
            color: #4b3b1f;
            margin-bottom: 25px;
            border-bottom: 2px dashed rgba(75, 59, 31, 0.3);
            padding-bottom: 10px;
            width: 100%;
            text-align: center;
        }

        .sidebar button {
            width: 100%;
            padding: 10px 0;
            border: none;
            background: #f8f1dc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia';
            color: #3e2f1c;
            font-weight: bold;
            margin-top: 10px;
        }

            .sidebar button:hover {
                background: #e9d7ae;
                transform: scale(1.05);
            }

    .content {
        flex-grow: 1;
        padding: 50px 70px;
        text-align: center;
        position: relative;
    }

    h1 {
        font-size: 28px;
        margin-bottom: 25px;
        color: #4a3825;
        letter-spacing: 0.5px;
        border-bottom: 2px dashed #b59f7b;
        padding-bottom: 10px;
    }

    label {
        display: block;
        text-align: left;
        margin-top: 20px;
        font-weight: bold;
        font-size: 15px;
    }

    input[type="text"], textarea {
        width: 100%;
        padding: 10px 12px;
        margin-top: 8px;
        border: 1px solid #c9b496;
        border-radius: 8px;
        background: #fffdf8;
        font-size: 15px;
        font-family: inherit;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05) inset;
        transition: border 0.3s;
    }

        input[type="text"]:focus, textarea:focus {
            border-color: #b59f7b;
            outline: none;
        }

    textarea {
        resize: vertical;
        min-height: 90px;
    }

    .image-section {
        margin-top: 10px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #preview {
        width: 160px;
        height: 220px;
        border-radius: 10px;
        object-fit: cover;
        margin-bottom: 10px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }

    #ImageFile {
        border: 2px dashed #bfa88f;
        padding: 8px;
        border-radius: 8px;
        background: #fffdf8;
        cursor: pointer;
        transition: all 0.3s ease;
    }

        #ImageFile:hover {
            background: #f5ebd6;
        }

    .stars {
        display: flex;
        justify-content: center;
        gap: 6px;
        margin-top: 12px;
        cursor: pointer;
    }

    .star {
        font-size: 30px;
        color: #d4c3a3;
        transition: color 0.3s, transform 0.2s;
    }

        .star.selected {
            color: #ffbf00;
            transform: scale(1.1);
        }

    button[type="submit"] {
        margin-top: 30px;
        background: linear-gradient(135deg, #6b4b3e 0%, #8b6a58 100%);
        color: #fff;
        border: none;
        padding: 12px 30px;
        border-radius: 10px;
        font-size: 17px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

        button[type="submit"]:hover {
            background: linear-gradient(135deg, #5a3d32 0%, #76584a 100%);
            transform: translateY(-2px);
        }
</style>

<div class="container">
    <div class="sidebar">
        <h3>@ViewBag.UserName</h3>
        <button onclick="location.href='@Url.Action("Libraries", "Library")'">📚 Bütün Kitabxanalar</button>
        <button onclick="location.href='@Url.Action("Page", "Page")'">⬅ Geri Qayıt</button>
        <button onclick="location.href='@Url.Action("Login", "Account")'">🚪 Çıxış</button>
    </div>

    <div class="content">
        <h1>📖 @(Model?.Id > 0 ? "Kitabı Redaktə Et" : "Yeni Kitab Əlavə Et")</h1>

        <form id="bookForm" asp-action="AddBook" asp-controller="Page" method="post" enctype="multipart/form-data">

            <!-- Hidden field for book ID (update zamanı lazımdır) -->
            <input type="hidden" asp-for="Id" />

            <div class="image-section">
                <img id="preview"
                     src="@(Model?.ImagePath ?? "")"
                     alt="Şəkil"
                     style="@(string.IsNullOrEmpty(Model?.ImagePath) ? "display:none;" : "")" />

                <!-- DÜZƏLİŞ: name="ImageFile" olmalıdır, asp-for="ImagePath" DEYİL -->
                <input type="file" id="ImageFile" name="ImageFile" accept="image/*" />
            </div>

            <label>Kitabın Adı</label>
            <input type="text" asp-for="Title" placeholder="Məsələn: Səssiz Pasajlar" required />

            <label>Qeydlər</label>
            <textarea asp-for="Notes" placeholder="Kitab haqqında qeydlər..."></textarea>

            <label>Təəssüratlar</label>
            <textarea asp-for="Thoughts" placeholder="Bu kitab sənə nə hiss etdirdi?"></textarea>

            <label>Qiymətləndirmə (5 üzərindən)</label>
            <div class="stars" id="starRating">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
            <input type="hidden" asp-for="Rating" id="RatingValue" value="@(Model?.Rating ?? 0)" />

            <button type="submit">@(Model?.Id > 0 ? "Yadda Saxla" : "Əlavə Et")</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const imageInput = document.getElementById('ImageFile');
        const preview = document.getElementById('preview');
        const stars = document.querySelectorAll('.star');
        const ratingValue = document.getElementById('RatingValue');

        // Mövcud reytinqi göstər
        const currentRating = parseInt(ratingValue.value) || 0;
        for (let i = 0; i < currentRating; i++) {
            stars[i].classList.add('selected');
        }

        // Şəkil seçildikdə ekranda göstər
        imageInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                alert('Zəhmət olmasa şəkil faylı seçin!');
                imageInput.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = ev => {
                preview.src = ev.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        // Ulduz sistemini aktivləşdirmək
        stars.forEach(star => {
            star.addEventListener('click', () => {
                const value = parseInt(star.getAttribute('data-value'));
                ratingValue.value = value;
                stars.forEach(s => s.classList.remove('selected'));
                for (let i = 0; i < value; i++) stars[i].classList.add('selected');
            });
        });
    });
</script>